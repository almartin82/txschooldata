---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%",
  message = FALSE,
  warning = FALSE
)
```

# txschooldata

<!-- badges: start -->
[![R-CMD-check](https://github.com/almartin82/txschooldata/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/almartin82/txschooldata/actions/workflows/R-CMD-check.yaml)
[![Python Tests](https://github.com/almartin82/txschooldata/actions/workflows/python-test.yaml/badge.svg)](https://github.com/almartin82/txschooldata/actions/workflows/python-test.yaml)
[![pkgdown](https://github.com/almartin82/txschooldata/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/almartin82/txschooldata/actions/workflows/pkgdown.yaml)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

An R package for fetching and processing Texas school enrollment, graduation, and assessment data from the Texas Education Agency (TEA). Texas public schools enroll **5.5 million students** across 1,200+ districts -- the second-largest school system in the United States. One function call pulls it all into R.

This package is part of the [njschooldata](https://github.com/almartin82/njschooldata) family of packages providing consistent access to state education data.

**Documentation: <https://almartin82.github.io/txschooldata/>**

## Installation

### R

```{r install, eval = FALSE}
# install.packages("remotes")
remotes::install_github("almartin82/txschooldata")
```

### Python

```{r install-py, eval = FALSE}
pip install git+https://github.com/almartin82/txschooldata.git#subdirectory=pytxschooldata
```

## Quick Start

### R

```{r quickstart-enr, eval = FALSE}
library(txschooldata)
library(dplyr)

# Fetch 2024 enrollment data (2023-24 school year)
enr <- fetch_enr(2024)

# Statewide total enrollment
enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(n_students)
#> 5,517,464 students
```

### Python

```python
from pytxschooldata import fetch_enr

enr = fetch_enr(2024)
print(enr.head())
```

## What can you find with txschooldata?

```{r load-data, cache = TRUE}
library(txschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)

# Fetch 5 years of enrollment data
enr <- fetch_enr_multi(2020:2024, use_cache = TRUE)
```

Here are fifteen narratives hiding in the numbers.

---

### 1. COVID erased a decade of growth in one year

```{r covid}
state_trend <- enr %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  select(end_year, n_students) %>%
  arrange(end_year) %>%
  mutate(
    change = n_students - lag(n_students),
    pct_change = round(change / lag(n_students) * 100, 2)
  )

stopifnot(nrow(state_trend) > 0)
print(state_trend)
```

**-120,133 students** vanished between 2020 and 2021 -- equivalent to the entire enrollment of El Paso ISD.

![COVID enrollment drop](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/covid-plot-1.png)

---

### 2. One in four students is now an English learner

```{r lep}
lep_trend <- enr %>%
  filter(is_state, subgroup == "lep", grade_level == "TOTAL") %>%
  select(end_year, n_students, pct) %>%
  mutate(pct_display = round(pct * 100, 1))

stopifnot(nrow(lep_trend) > 0)
print(lep_trend %>% select(end_year, n_students, pct_display))
```

![LEP trend](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/lep-plot-1.png)

From 20.3% to **24.4%** in five years. Schools need more ESL teachers than ever.

---

### 3. Coppell ISD is Texas's first Asian-majority district

```{r asian}
# Districts with highest Asian percentage
asian_top <- enr %>%
  filter(is_district, subgroup == "asian", grade_level == "TOTAL", end_year == 2024) %>%
  inner_join(
    enr %>% filter(is_district, subgroup == "total_enrollment",
                   grade_level == "TOTAL", end_year == 2024) %>%
      select(district_id, total = n_students),
    by = "district_id"
  ) %>%
  filter(total >= 10000) %>%
  arrange(desc(pct)) %>%
  select(district_name, total, n_students, pct) %>%
  mutate(pct = round(pct * 100, 1)) %>%
  head(10)

stopifnot(nrow(asian_top) > 0)
print(asian_top)
```

**56.7% Asian**. Frisco ISD jumped from 33.6% to 42.6% in just three years.

![Frisco Asian growth](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/frisco-trend-1.png)

---

### 4. Fort Worth ISD lost 14% of its students

```{r decline}
# Calculate 2020-2024 changes using district_id (2020 data has NA names)
d2020 <- enr %>%
  filter(is_district, subgroup == "total_enrollment",
         grade_level == "TOTAL", end_year == 2020) %>%
  select(district_id, n_2020 = n_students)

d2024 <- enr %>%
  filter(is_district, subgroup == "total_enrollment",
         grade_level == "TOTAL", end_year == 2024) %>%
  select(district_id, district_name, n_2024 = n_students)

losses <- d2020 %>%
  inner_join(d2024, by = "district_id") %>%
  mutate(
    change = n_2024 - n_2020,
    pct_change = round((change / n_2020) * 100, 1)
  )

# Largest percentage losses among big districts
top_losses <- losses %>%
  filter(n_2020 >= 10000) %>%
  arrange(pct_change) %>%
  select(district_name, n_2020, n_2024, change, pct_change) %>%
  head(10)

stopifnot(nrow(top_losses) > 0)
print(top_losses)
```

Urban districts are bleeding students to suburbs and charters.

---

### 5. IDEA Public Schools grew 55% in five years

```{r idea}
# Use district_id join to include 2020 (which has NA district_name)
idea_trend <- losses %>%
  filter(grepl("IDEA", district_name))

stopifnot(nrow(idea_trend) > 0)
print(idea_trend %>% select(district_name, n_2020, n_2024, change, pct_change))

# Year-by-year for 2021-2024 (name filter works for these years)
idea_yearly <- enr %>%
  filter(district_name == "IDEA PUBLIC SCHOOLS", is_district,
         subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  select(end_year, n_students) %>%
  arrange(end_year)

stopifnot(nrow(idea_yearly) > 0)
print(idea_yearly)
```

From 49,480 to **76,819 students** (+55.3%). Charter networks are reshaping Texas education.

---

### 6. Fort Bend ISD has no racial majority

```{r fort-bend}
fb_demo <- enr %>%
  filter(district_name == "FORT BEND ISD", is_district, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian")) %>%
  select(end_year, subgroup, pct) %>%
  mutate(pct = round(pct * 100, 1)) %>%
  pivot_wider(names_from = subgroup, values_from = pct)

stopifnot(nrow(fb_demo) > 0)
print(fb_demo)
```

No group exceeds 28%. One of the most diverse large districts in America.

![Fort Bend demographics](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/diversity-chart-1.png)

---

### 7. Kindergarten enrollment dropped 5.8%

```{r kindergarten}
grade_trend <- enr %>%
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("PK", "K", "01", "05", "09", "12")) %>%
  select(end_year, grade_level, n_students) %>%
  pivot_wider(names_from = end_year, values_from = n_students) %>%
  mutate(
    change = `2024` - `2020`,
    pct_change = round(change / `2020` * 100, 1)
  )

stopifnot(nrow(grade_trend) > 0)
print(grade_trend)
```

**-22,256 kindergartners** since 2020. The pipeline is narrowing.

---

### 8. 62% of students are economically disadvantaged

```{r econ}
econ_trend <- enr %>%
  filter(is_state, subgroup == "econ_disadv", grade_level == "TOTAL") %>%
  select(end_year, n_students, pct) %>%
  mutate(pct = round(pct * 100, 1))

stopifnot(nrow(econ_trend) > 0)
print(econ_trend)
```

![Econ disadvantaged trend](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/econ-plot-1.png)

Up from 60.3%. Nearly two-thirds of Texas students qualify.

---

### 9. White students dropped below 25%

```{r demographics}
demo_shift <- enr %>%
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian", "multiracial")) %>%
  select(end_year, subgroup, pct) %>%
  mutate(pct = round(pct * 100, 1)) %>%
  pivot_wider(names_from = subgroup, values_from = pct)

stopifnot(nrow(demo_shift) > 0)
print(demo_shift)
```

![Demographics over time](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/demo-plot-1.png)

Hispanic students are now **53.2%** of enrollment.

---

### 10. 439 districts now have Hispanic majorities

```{r hispanic-majority}
hisp_majority <- enr %>%
  filter(is_district, subgroup == "hispanic", grade_level == "TOTAL") %>%
  mutate(majority = pct > 0.5) %>%
  group_by(end_year) %>%
  summarize(
    total_districts = n(),
    hispanic_majority = sum(majority),
    pct_majority = round(hispanic_majority / total_districts * 100, 1),
    .groups = "drop"
  )

stopifnot(nrow(hisp_majority) > 0)
print(hisp_majority)
```

Up from 419 in 2020. Now **36.4%** of all Texas school districts.

---

### 11. Houston ISD vs Dallas ISD: two giants, two trajectories

```{r houston-vs-dallas}
# Use district_id to include 2020 (which has NA district_name)
big_two_ids <- c("101912", "057905")  # Houston ISD, Dallas ISD

big_two <- enr %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_id %in% big_two_ids) %>%
  mutate(district_label = case_when(
    district_id == "101912" ~ "HOUSTON ISD",
    district_id == "057905" ~ "DALLAS ISD"
  )) %>%
  select(end_year, district_label, n_students) %>%
  pivot_wider(names_from = district_label, values_from = n_students) %>%
  arrange(end_year) %>%
  mutate(
    houston_change = `HOUSTON ISD` - lag(`HOUSTON ISD`),
    dallas_change = `DALLAS ISD` - lag(`DALLAS ISD`)
  )

stopifnot(nrow(big_two) > 0)
print(big_two)
```

![Houston vs Dallas](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/houston-vs-dallas-plot-1.png)

Houston lost **25,706 students** (-12.3%) vs Dallas's **14,688** (-9.5%) between 2020 and 2024.

---

### 12. Nearly 1 in 7 students receives special education

```{r sped}
sped_2024 <- enr %>%
  filter(is_state, subgroup == "special_ed", grade_level == "TOTAL", end_year == 2024) %>%
  select(end_year, n_students, pct) %>%
  mutate(pct_display = round(pct * 100, 1))

stopifnot(nrow(sped_2024) > 0)
print(sped_2024 %>% select(end_year, n_students, pct_display))
```

**764,858 students** (13.9%) receive special education services in 2024.

---

### 13. Suburban boomtowns are reshaping Texas education

```{r suburban-growth}
# Top growing large districts (using district_id join for accurate 2020-2024 comparison)
suburban_growth <- losses %>%
  filter(n_2020 >= 5000) %>%
  arrange(desc(pct_change)) %>%
  select(district_name, n_2020, n_2024, change, pct_change) %>%
  head(10)

stopifnot(nrow(suburban_growth) > 0)
print(suburban_growth)
```

Hallsville ISD nearly doubled (+85.7%), Prosper ISD grew 69.1%. While urban cores lose students, suburban boomtowns absorb the growth.

---

### 14. Pre-K enrollment still hasn't recovered from COVID

```{r pk-recovery}
pk_trend <- enr %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "PK") %>%
  select(end_year, n_students) %>%
  arrange(end_year) %>%
  mutate(
    change = n_students - lag(n_students),
    pct_change = round(change / lag(n_students) * 100, 1),
    vs_2020 = n_students - first(n_students)
  )

stopifnot(nrow(pk_trend) > 0)
print(pk_trend)
```

![Pre-K recovery](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/pk-recovery-plot-1.png)

Pre-K cratered 21% during COVID. By 2024 it has clawed back to 247,979 -- still **434 students short** of 2020 levels.

---

### 15. Multiracial students are the fastest-growing demographic

```{r multiracial}
multi_trend <- enr %>%
  filter(is_state, subgroup == "multiracial", grade_level == "TOTAL") %>%
  select(end_year, n_students, pct) %>%
  mutate(pct_display = round(pct * 100, 1))

stopifnot(nrow(multi_trend) > 0)
print(multi_trend %>% select(end_year, n_students, pct_display))
```

![Multiracial growth](https://almartin82.github.io/txschooldata/articles/district-hooks_files/figure-html/multiracial-plot-1.png)

From 138,434 to 173,425 -- a **25% increase** in raw numbers. The fastest-growing demographic group in Texas.

---

## Graduation rates

Track four-year longitudinal graduation rates for the Class of 2003-2024:

```{r grad-rates}
library(txschooldata)

# Get Class of 2024 graduation rates
grad <- fetch_grad(2024, use_cache = TRUE)

# State graduation rate by subgroup
grad |>
  filter(type == "State") |>
  select(subgroup, grad_rate) |>
  arrange(desc(grad_rate))
```

Data available for all students plus race/ethnicity, gender, and special populations (economically disadvantaged, special education, LEP, at-risk).

---

## Learn more

- **[Full analysis with 15 charts](https://almartin82.github.io/txschooldata/articles/district-hooks.html)**
- **[Getting started guide](https://almartin82.github.io/txschooldata/articles/quickstart.html)**
- **[Function reference](https://almartin82.github.io/txschooldata/reference/)**

## Data availability

This package pulls from three TEA reporting systems:

| System | Years | Notes |
|--------|-------|-------|
| **AEIS CGI** | 1997-2002 | Older AEIS format via CGI endpoint |
| **AEIS SAS** | 2003-2012 | Academic Excellence Indicator System |
| **TAPR** | 2013-2025 | Texas Academic Performance Reports |

All data is fetched directly from TEA servers -- no manual downloads required.

### What's included

**Enrollment data:**
- **Levels:** State, district (~1,200), and campus (~9,000)
- **Demographics:** White, Black, Hispanic, Asian, American Indian, Pacific Islander, Two or More Races
- **Special populations:** Economically disadvantaged, LEP/English learners, Special education, At-risk, Gifted
- **Grade levels:** Early Education (EE) through Grade 12, plus totals

**Graduation rate data:**
- **Years:** Class of 2003-2024 (four-year longitudinal rates)
- **Levels:** State, district, campus
- **Subgroups:** All students, race/ethnicity, gender, special populations
- **Note:** Uses federal calculation for consistency across years

### Data notes

- **IDs:** District IDs are 6 digits (e.g., `101912` for Houston ISD). Campus IDs are 9 digits (district + 3-digit campus number).
- **Tidy format:** By default, `fetch_enr()` returns long/tidy data with `subgroup`, `grade_level`, and `n_students` columns. Use `tidy = FALSE` for wide format.
- **Percentages:** The `pct` column is a proportion (0-1), not a percentage. Multiply by 100 for display.
- **Caching:** Data is cached locally after first download. Use `use_cache = FALSE` to force refresh.
- **Suppression:** TEA applies data masking to protect student privacy for small subgroups.

### Caveats

- **Asian/Pacific Islander:** Pre-2011 data combines Asian and Pacific Islander into a single "asian" category. Separate Pacific Islander data only available from 2011 onward (federal reporting change).
- **Two or More Races:** Only available from 2011 onward (federal reporting change)
- **Column names:** Standardized across years, but underlying TEA variable names differ between systems
- **Historical comparisons:** Definition of "economically disadvantaged" and other categories may shift over time

## Part of the State Schooldata Project

This package is part of the [njschooldata](https://github.com/almartin82/njschooldata) family of packages providing consistent access to state education data.

A simple, consistent interface for accessing state-published school data in Python and R.

**All 50 state packages:** [github.com/almartin82](https://github.com/almartin82?tab=repositories&q=schooldata)

## License

MIT
