---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  message = FALSE,
  warning = FALSE
)
```

# txschooldata

<!-- badges: start -->
[![R-CMD-check](https://github.com/almartin82/txschooldata/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/almartin82/txschooldata/actions/workflows/R-CMD-check.yaml)
[![Python Tests](https://github.com/almartin82/txschooldata/actions/workflows/python-test.yaml/badge.svg)](https://github.com/almartin82/txschooldata/actions/workflows/python-test.yaml)
[![pkgdown](https://github.com/almartin82/txschooldata/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/almartin82/txschooldata/actions/workflows/pkgdown.yaml)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

An R package for fetching and processing Texas school enrollment and assessment data from the Texas Education Agency (TEA).

**Documentation: <https://almartin82.github.io/txschooldata/>**

## Installation

```{r install, eval = FALSE}
# install.packages("remotes")
remotes::install_github("almartin82/txschooldata")
```

## Quick Start

### Enrollment Data

```{r quickstart-enr, eval = FALSE}
library(txschooldata)
library(dplyr)

# Fetch 2024 enrollment data (2023-24 school year)
enr <- fetch_enr(2024)

# Statewide total enrollment
enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(n_students)
#> 5,517,464 students
```

### STAAR Assessment Data

```{r quickstart-staar, eval = FALSE}
# Fetch 2023 STAAR data for Grade 3 Math (district level)
staar <- fetch_staar(2023, "district", 3, subject = "english")

# Get Houston ISD performance
staar |>
  filter(district_id == "101912", subject == "Math") |>
  select(district_name, all_total, all_did_not_meet, all_approaches, all_meets, all_masters)
#>   district_name all_total all_did_not_meet all_approaches all_meets all_masters
#> 1   HOUSTON ISD     10846             3488           7358      4716        3623
```

## What can you find with txschooldata?

Texas public schools enroll **5.5 million students** across 1,200+ districts. One function call pulls it all into R:

```{r load-data, cache = TRUE}
library(txschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)

# Grab 5 years of enrollment data
enr <- fetch_enr_multi(2020:2024)
```

Here are ten narratives hiding in the numbers.

---

### 1. COVID erased a decade of growth in one year

```{r covid}
enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students))
```

**-120,133 students** vanished between 2020 and 2021—equivalent to the entire enrollment of El Paso ISD.

---

### 2. One in four students is now an English learner

```{r lep}
lep <- enr |>
  filter(is_state, subgroup == "lep", grade_level == "TOTAL") |>
  select(end_year, n_students, pct) |>
  mutate(pct = round(pct * 100, 1))

lep
```

```{r lep-plot, fig.height = 3}
ggplot(lep, aes(end_year, pct)) +
  geom_line(linewidth = 1.2, color = "#E69F00") +
  geom_point(size = 3, color = "#E69F00") +
  geom_hline(yintercept = 25, linetype = "dashed", color = "gray50") +
  scale_y_continuous(limits = c(19, 27)) +
  labs(title = "LEP students as % of enrollment", x = NULL, y = NULL) +
  theme_minimal()
```

From 20.3% to **24.4%** in five years. Schools need more ESL teachers than ever.

---

### 3. Coppell ISD is Texas's first Asian-majority district

```{r asian}
enr |>
  filter(is_district, subgroup == "asian", grade_level == "TOTAL", end_year == 2024) |>
  inner_join(
    enr |> filter(is_district, subgroup == "total_enrollment",
                  grade_level == "TOTAL", end_year == 2024) |>
      select(district_id, total = n_students),
    by = "district_id"
  ) |>
  filter(total >= 10000) |>
  arrange(desc(pct)) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(district_name, total, pct) |>
  head(8)
```

**56.7% Asian**. Frisco ISD jumped from 33.6% to 42.6% in just three years.

---

### 4. Fort Worth ISD lost 14% of its students

```{r decline}
d2020 <- enr |>
  filter(is_district, subgroup == "total_enrollment",
         grade_level == "TOTAL", end_year == 2020) |>
  select(district_id, n_2020 = n_students)

d2024 <- enr |>
  filter(is_district, subgroup == "total_enrollment",
         grade_level == "TOTAL", end_year == 2024) |>
  select(district_id, district_name, n_2024 = n_students)

d2020 |>
  inner_join(d2024, by = "district_id") |>
  mutate(change = n_2024 - n_2020, pct = round(change / n_2020 * 100, 1)) |>
  filter(n_2020 >= 10000) |>
  arrange(pct) |>
  select(district_name, n_2020, n_2024, change, pct) |>
  head(8)
```

Urban districts are bleeding students to suburbs and charters.

---

### 5. IDEA Public Schools grew 24% in three years

```{r idea}
enr |>
  filter(district_name == "IDEA PUBLIC SCHOOLS", is_district,
         subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students)
```

From 62,158 to **76,819 students**. Charter networks are reshaping Texas education.

---

### 6. Fort Bend ISD has no racial majority

```{r fort-bend}
enr |>
  filter(district_name == "FORT BEND ISD", is_district, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian"), end_year == 2024) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, pct) |>
  arrange(desc(pct))
```

No group exceeds 28%. One of the most diverse large districts in America.

---

### 7. Kindergarten enrollment dropped 5.8%

```{r kindergarten}
enr |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("PK", "K", "01", "09", "12")) |>
  select(end_year, grade_level, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students) |>
  mutate(change = `2024` - `2020`, pct = round(change / `2020` * 100, 1))
```

**-22,256 kindergartners** since 2020. The pipeline is narrowing.

---

### 8. 62% of students are economically disadvantaged

```{r econ}
econ <- enr |>
  filter(is_state, subgroup == "econ_disadv", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct)

econ
```

```{r econ-plot, fig.height = 3}
ggplot(econ, aes(end_year, pct)) +
  geom_col(fill = "#56B4E9", width = 0.6) +
  geom_text(aes(label = paste0(pct, "%")), vjust = -0.3, size = 3.5) +
  scale_y_continuous(limits = c(0, 70)) +
  labs(title = "Economically disadvantaged students (%)", x = NULL, y = NULL) +
  theme_minimal()
```

Up from 60.3%. Nearly two-thirds of Texas students qualify.

---

### 9. White students dropped below 25%

```{r demographics}
enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "hispanic", "black", "asian")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, subgroup, pct) |>
  pivot_wider(names_from = subgroup, values_from = pct)
```

```{r demo-plot, fig.height = 3.5}
enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "hispanic", "black", "asian")) |>
  mutate(pct = pct * 100) |>
  ggplot(aes(end_year, pct, color = subgroup)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_color_manual(
    values = c("hispanic" = "#0072B2", "white" = "#E69F00",
               "black" = "#009E73", "asian" = "#CC79A7"),
    labels = c("Asian", "Black", "Hispanic", "White")
  ) +
  labs(title = "Demographics over time", x = NULL, y = "Percent", color = NULL) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

Hispanic students are now **53.2%** of enrollment.

---

### 10. 439 districts now have Hispanic majorities

```{r hispanic-majority}
enr |>
  filter(is_district, subgroup == "hispanic", grade_level == "TOTAL") |>
  group_by(end_year) |>
  summarize(
    total_districts = n(),
    hispanic_majority = sum(pct > 0.5),
    pct_majority = round(hispanic_majority / total_districts * 100, 1)
  )
```

Up from 419 in 2020. Now **36%** of all Texas school districts.

---

## Graduation rates

Track four-year longitudinal graduation rates for the Class of 2003-2024:

```{r grad-rates}
library(txschooldata)

# Get Class of 2024 graduation rates
grad <- fetch_grad(2024)

# State graduation rate by subgroup
grad |>
  filter(type == "State") |>
  select(subgroup, grad_rate) |>
  arrange(desc(grad_rate))
```

Data available for all students plus race/ethnicity, gender, and special populations (economically disadvantaged, special education, LEP, at-risk).

---

## Learn more

- **[Full analysis with more charts](https://almartin82.github.io/txschooldata/articles/district-hooks.html)**
- **[Getting started guide](https://almartin82.github.io/txschooldata/articles/quickstart.html)**
- **[Function reference](https://almartin82.github.io/txschooldata/reference/)**

## Data availability

This package pulls from three TEA reporting systems:

| System | Years | Notes |
|--------|-------|-------|
| **AEIS CGI** | 1997-2002 | Older AEIS format via CGI endpoint |
| **AEIS SAS** | 2003-2012 | Academic Excellence Indicator System |
| **TAPR** | 2013-2025 | Texas Academic Performance Reports |

All data is fetched directly from TEA servers—no manual downloads required.

### What's included

**Enrollment data:**
- **Levels:** State, district (~1,200), and campus (~9,000)
- **Demographics:** White, Black, Hispanic, Asian, American Indian, Pacific Islander, Two or More Races
- **Special populations:** Economically disadvantaged, LEP/English learners, Special education, At-risk, Gifted
- **Grade levels:** Early Education (EE) through Grade 12, plus totals

**Graduation rate data:**
- **Years:** Class of 2003-2024 (four-year longitudinal rates)
- **Levels:** State, district, campus
- **Subgroups:** All students, race/ethnicity, gender, special populations
- **Note:** Uses federal calculation for consistency across years

**STAAR assessment data:**
- **Years:** 2018, 2021-2023 (legacy format)
- **Levels:** District (~1,200) and campus (~9,000)
- **Grades:** 3-8
- **Subjects:** Reading/Language Arts (RLA) and Math
- **Performance levels:** Did Not Meet, Approaches, Meets, Masters Grade Level
- **Note:** 2019-2020 not available (COVID-19 pandemic disrupted testing)

### Formatting notes

- **IDs:** District IDs are 6 digits (e.g., `101912` for Austin ISD). Campus IDs are 9 digits (district + 3-digit campus number).
- **Tidy format:** By default, `fetch_enr()` returns long/tidy data with `subgroup`, `grade_level`, and `n_students` columns. Use `tidy = FALSE` for wide format. STAAR data works similarly with `fetch_staar()`.
- **Percentages:** The `pct` column is a proportion (0-1), not a percentage. Multiply by 100 for display.
- **Caching:** Data is cached locally after first download. Use `use_cache = FALSE` to force refresh.
- **STAAR performance levels:** TEA's performance level counts may not sum to the total tested count. This is the TEA's data structure (students may be counted in multiple categories depending on reporting methodology).

### Caveats

- **Asian/Pacific Islander:** Pre-2011 data combines Asian and Pacific Islander into a single "asian" category. Separate Pacific Islander data only available from 2011 onward (federal reporting change).
- **Two or More Races:** Only available from 2011 onward (federal reporting change)
- **Column names:** Standardized across years, but underlying TEA variable names differ between systems
- **Historical comparisons:** Definition of "economically disadvantaged" and other categories may shift over time

## License

MIT
