---
title: "Data Quality Analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data Quality Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  eval = FALSE
)
```

## Overview

This vignette performs quality assurance checks on Texas public school enrollment data from the Texas Education Agency (TEA). We analyze statewide trends and examine data for major districts to identify any anomalies or data quality issues.

## Data Coverage

TEA enrollment data is available through the TAPR (Texas Academic Performance Reports) system from 2020 onwards via the current download interface.

```{r load-packages}
library(txschooldata)
library(dplyr)
library(ggplot2)
library(scales)
```

## Statewide Enrollment Analysis

### Multi-Year Download

```{r download-multi-year, cache=TRUE}
# Download enrollment data for available years
years <- 2020:2024
enr_multi <- fetch_enr_multi(years)

# State-level total enrollment by year
state_totals <- enr_multi %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  select(end_year, n_students) %>%
  arrange(end_year)

print(state_totals)
```

### Statewide Enrollment Trend

```{r state-trend-plot}
state_totals %>%
  ggplot(aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#003366") +
  geom_point(size = 3, color = "#003366") +
  scale_y_continuous(labels = comma, limits = c(0, NA)) +
  labs(
    title = "Texas Public School Enrollment",
    subtitle = "Total K-12 enrollment, 2020-2024",
    x = "School Year (End)",
    y = "Total Students",
    caption = "Source: Texas Education Agency TAPR"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.minor = element_blank()
  )
```

## Notes

### Data Source
All data comes from the Texas Education Agency's TAPR (Texas Academic Performance Reports) system:
https://rptsvr1.tea.texas.gov/perfreport/tapr/

### Known Limitations

1. **Historical Data**: The current download interface only supports years 2020 and later.
2. **COVID-19 Impact**: The 2020-2021 school year saw significant enrollment disruptions.
3. **Charter Schools**: Charter school data is included in district totals.
4. **Data Masking**: TEA applies data masking to protect student privacy for small subgroups.
