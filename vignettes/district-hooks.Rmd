---
title: "10 Things You Didn't Know About Texas Schools"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{10 Things You Didn't Know About Texas Schools}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  eval = FALSE
)
```

```{r load-packages}
library(txschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
```

Texas public schools enroll over 5.5 million students across 1,200+ districts, making it the second-largest school system in the United States. This analysis explores the most striking patterns in Texas enrollment data from 2020-2024.

```{r fetch-data, cache=TRUE}
# Fetch 5 years of enrollment data
enr <- fetch_enr_multi(2020:2024)
```

---

## 1. COVID Erased a Decade of Growth in One Year

The pandemic caused the largest single-year enrollment drop in Texas history. Between 2020 and 2021, Texas public schools lost **120,133 students**---equivalent to the entire enrollment of El Paso ISD, the 7th largest district in the state.

```{r covid-drop}
state_trend <- enr %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  select(end_year, n_students) %>%
  arrange(end_year) %>%
  mutate(
    change = n_students - lag(n_students),
    pct_change = round(change / lag(n_students) * 100, 2)
  )

print(state_trend)
```

```{r covid-plot}
ggplot(state_trend, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#003366") +
  geom_point(size = 3, color = "#003366") +
  geom_segment(aes(x = 2020, xend = 2021, y = 5479173, yend = 5359040),
               color = "#CC0000", linewidth = 1.2, linetype = "dashed") +
  annotate("text", x = 2020.5, y = 5380000, label = "-120,133",
           color = "#CC0000", fontface = "bold", size = 4) +
  scale_y_continuous(labels = comma, limits = c(5300000, 5600000)) +
  labs(
    title = "Texas Public School Enrollment",
    subtitle = "The COVID dip and slow recovery",
    x = "School Year (End)", y = "Total Students"
  ) +
  theme_minimal()
```

Enrollment has since recovered, surpassing pre-pandemic levels by 2023. But the demographic composition of that recovery tells a very different story.

---

## 2. One in Four Students is Now an English Learner

The proportion of **Limited English Proficient (LEP)** students grew by 4.1 percentage points in just five years---from 20.3% to 24.4% of all students. This is the single largest demographic shift in the data.

```{r lep-growth}
lep_trend <- enr %>%
  filter(is_state, subgroup == "lep", grade_level == "TOTAL") %>%
  select(end_year, n_students, pct) %>%
  mutate(pct_display = round(pct * 100, 1))

print(lep_trend %>% select(end_year, n_students, pct_display))
```

```{r lep-plot}
ggplot(lep_trend, aes(x = end_year, y = pct * 100)) +
  geom_line(linewidth = 1.2, color = "#E69F00") +
  geom_point(size = 3, color = "#E69F00") +
  geom_hline(yintercept = 25, linetype = "dashed", color = "gray50") +
  annotate("text", x = 2024.3, y = 25.5, label = "1 in 4", color = "gray40", size = 3.5) +
  scale_y_continuous(limits = c(19, 27)) +
  labs(
    title = "Rise of English Learners",
    subtitle = "LEP students as % of total enrollment",
    x = "School Year (End)", y = "Percent"
  ) +
  theme_minimal()
```

This has profound implications for staffing, curriculum, and resource allocation across the state. Schools need more ESL teachers, bilingual programs, and translated materials than ever before.

---

## Summary

These findings illustrate the rapid transformation of Texas public education. Use `txschooldata` to explore these patterns yourself.
