---
title: "Getting Started with txschooldata"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with txschooldata}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  eval = FALSE
)
```

## Installation

```{r install}
# install.packages("remotes")
remotes::install_github("almartin82/txschooldata")
```

## Basic Usage

```{r basic}
library(txschooldata)
library(dplyr)

# Fetch 2024 data (2023-24 school year)
enr <- fetch_enr(2024)

# Statewide total enrollment
enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(n_students)
#> 5,517,464 students
```

Data is returned in **tidy (long) format** by default. Each row is one subgroup for one entity (state/district/campus).

## Key Columns

| Column | Description |
|--------|-------------|
| `end_year` | School year end (2024 = 2023-24) |
| `district_id` | 6-digit district ID |
| `district_name` | District name |
| `subgroup` | Demographic group |
| `grade_level` | Grade ("TOTAL", "K", "01"-"12") |
| `n_students` | Student count |
| `pct` | Percent of total |
| `is_state`, `is_district`, `is_campus` | Level flags |

## Filtering by Level

```{r filter}
# State totals
enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL")

# All districts
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL")

# All campuses
enr |>
  filter(is_campus, subgroup == "total_enrollment", grade_level == "TOTAL")
```

## Top Districts

```{r top-districts}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  select(district_name, n_students) |>
  head(5)
#>     district_name n_students
#> 1     HOUSTON ISD     178,579
#> 2      DALLAS ISD     134,624
#> 3  FORT WORTH ISD      70,903
#> 4 NORTHSIDE ISD      109,541
#> 5      AUSTIN ISD      73,089
```

## Demographics for One District

```{r demo}
# Austin ISD demographics
enr |>
  filter(
    district_id == "227901",
    is_district,
    grade_level == "TOTAL",
    subgroup != "total_enrollment"
  ) |>
  arrange(desc(n_students)) |>
  select(subgroup, n_students, pct) |>
  head(5)
#>      subgroup n_students  pct
#> 1    hispanic     39,445 0.54
#> 2       white     16,162 0.22
#> 3       black      5,847 0.08
#> 4       asian      3,950 0.05
#> 5  multiracial     3,684 0.05
```

## Multi-Year Trends

```{r multi-year}
enr_multi <- fetch_enr_multi(2022:2024)

# State enrollment trend
enr_multi |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students)
#>   end_year n_students
#> 1     2022    5402928
#> 2     2023    5504150
#> 3     2024    5517464
```

## Wide Format

For one column per demographic:

```{r wide}
enr_wide <- fetch_enr(2024, tidy = FALSE)
```

## Visualization

```{r viz}
library(ggplot2)
library(scales)

enr_multi <- fetch_enr_multi(2020:2024)

# Demographics over time
enr_multi |>
  filter(
    is_state,
    subgroup %in% c("white", "black", "hispanic", "asian"),
    grade_level == "TOTAL"
  ) |>
  ggplot(aes(x = end_year, y = pct, color = subgroup)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_y_continuous(labels = percent_format()) +
  labs(
    title = "Texas Public School Demographics",
    x = "School Year", y = "Percent", color = NULL
  ) +
  theme_minimal()
```

## Available Subgroups

**Demographics:** white, black, hispanic, asian, native_american, pacific_islander, multiracial

**Special Populations:** special_ed, lep (English learners), econ_disadv

**Totals:** total_enrollment

## Cache Management

```{r cache}
# View cached files
cache_status()

# Clear all cached data
clear_cache()

# Clear specific year
clear_cache(2024)
```

## Next Steps

- See [10 Things You Didn't Know About Texas Schools](district-hooks.html) for detailed analysis with real data and visualizations
- See [Data Quality Analysis](data-quality-qa.html) for state and district enrollment trends
- Use `?fetch_enr` for complete function documentation
